---
comments: true
---

# Updating to the Next Protocol Version

This guide outlines the general process for updating the **Allay** core to a new Minecraft Bedrock Edition protocol
version. In practice, special cases may occur, so do not rely solely on this guide.

## 1. Update Endstone

Before updating Allay, you need to extract the latest data from BDS using **Endstone DevTools**.
First, update [Endstone](https://github.com/EndstoneMC/endstone/releases) to the latest version.
Then, use it to export the following files:

- `biomes.json`
- `block_palette.nbt`
- `block_states.json`
- `block_tags.json`
- `block_types.json`
- `creative_groups.json`
- `creative_items.nbt`
- `item_components.nbt`
- `item_tags.json`
- `items.json`
- `recipes.json`

## 2. Update Resource Files (`data/resources`)

### Files obtained directly

| File                                                    | Source                                                                                                                    |
|---------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|
| `biome_definitions.json`                                | [pmmp/BedrockData](https://github.com/pmmp/BedrockData)                                                                   |
| `entity_identifiers.nbt`                                | [pmmp/BedrockData](https://github.com/pmmp/BedrockData)                                                                   |
| `music_definitions.json`                                | [Mojang/bedrock-samples](https://github.com/Mojang/bedrock-samples/blob/main/resource_pack/sounds/music_definitions.json) |
| `sound_definitions.json`                                | [Mojang/bedrock-samples](https://github.com/Mojang/bedrock-samples/blob/main/resource_pack/sounds/sound_definitions.json) |
| Others (`block_types.json`, `creative_items.nbt`, etc.) | Exported from Endstone                                                                                                    |

### Manually maintained files

| File                     | Notes                                                                                                              |
|--------------------------|--------------------------------------------------------------------------------------------------------------------|
| `block_tags_custom.json` | Update manually if IDs have changed                                                                                |
| `item_tags_custom.json`  | Same as above                                                                                                      |
| `trim_data.json`         | Rarely changes; can be updated using [CloudburstMC/ProxyPass](https://github.com/CloudburstMC/ProxyPass) if needed |

## 3. Update Files in `data/resources/unpacked`

These are used in code generation and are not included in the final `.jar`:

| File                        | Source / Notes                                          |
|-----------------------------|---------------------------------------------------------|
| `block_tags.json`           | From Endstone                                           |
| `block_states_raw.json`     | Rename `block_states.json` from Endstone                |
| `block_palette.nbt`         | From Endstone                                           |
| `item_tags.json`            | From Endstone                                           |
| `block_property_types.json` | Generated by running `BlockPropertyTypeDataFileGen`     |
| `biome_id_and_type.json`    | Update manually (biomes rarely change)                  |
| `entity_id_map.json`        | [pmmp/BedrockData](https://github.com/pmmp/BedrockData) |

## 4. Generate Derived Files

### `block_states.json`

Generate using `BlockStateDataProcessor`, based on `block_states_raw.json`.

### Language Files

1. Copy original `.lang` files from `endstone/bedrock_server/resource_packs/vanilla/texts` to
   `unpacked/lang_raw/vanilla`.
2. Run `LangBuilder` in `data`.
3. Then run `TrKeysGen` in `codegen`.

## 5. Code Generation (`codegen`)

| Generator                                         | When to Run                                                                                                                                                                                   |
|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `SoundNameGen`                                    | If `music_definitions.json` or `sound_definitions.json` changed                                                                                                                               |
| `BiomeIdEnumGen`                                  | If `biome_id_and_type.json` changed                                                                                                                                                           |
| `EntityClassGen`                                  | If `entity_id_map.json` changed                                                                                                                                                               |
| `TagGen`                                          | If `item_tags.json` or `block_tags.json` changed                                                                                                                                              |
| `BlockIdEnumGen` → `BlockPropertyTypeDataFileGen` | Always after block updates                                                                                                                                                                    |
| `BlockClassGen`                                   | Requires manual edits:<br>– Delete old blocks<br>– Update properties and logic<br>– Check `BlockTypeInitializer.java` for errors<br>– Add merged blocks in `registerMergedBlocks()` if needed |
| `ItemClassGen`                                    | Similar to blocks:<br>– Remove old items<br>– Migrate logic if only names changed<br>– Add merged items in `registerMergedItems()` if needed                                                  |

## 6. Update Dependencies and `ProtocolInfo.java`

Update to the latest versions of:

- [CloudburstMC/Protocol](https://github.com/CloudburstMC/Protocol)
- [AllayMC/StateUpdater](https://github.com/AllayMC/StateUpdater)

Modify `ProtocolInfo.java` fields:

- `PACKET_CODEC`
- `MINECRAFT_VERSION`

If you're unsure about the new `MINECRAFT_VERSION`, refer
to [pmmp/PocketMine-MP](https://github.com/pmmp/PocketMine-MP).
Ensure dependencies are updated before editing this file.

## 7. Test and Finalize

1. Run `gradle test` to ensure all tests pass.
2. Update the client and test connectivity with the server.
3. Once verified, the update is considered complete.

Don't forget to record all changes in `CHANGELOG.md`.